# nimi - Kimi复刻版浏览器插件

✨ 复刻Kimi的核心功能，包括全文摘要、划词点问、浮窗交互等。

## 功能特性

### 1. 网页级能力
- **全文摘要**：自动提取网页内容并生成 3-5 句 Markdown 摘要
- **划词点问**：选中网页文本，弹出"点我问"按钮，可即时获得解释/翻译/计算结果

### 2. 交互级能力
- **全局浮窗模式**：右下角 360×480 浮窗，支持拖拽
- **侧边栏模式**：右侧 340px 侧边栏，不遮挡主要内容
- **快捷键召唤**：使用 `Alt+K` (Mac: `Option+K`) 快速打开/关闭

### 3. 模型/数据级能力
- **本地模型推理**：兼容 OpenAI API 格式，可接入内网 LLM 服务
- **用户指令模板**：可自定义 3 组常用指令模板
- **上下文缓存**：每个标签页维护独立的对话上下文

## 目录结构

```
nimi/
├── manifest.json              # 插件清单 (V3)
├── background.js              # 后台脚本 (处理快捷键、右键菜单)
├── content-script.js          # 内容脚本 (核心功能)
├── popup.html                 # 设置页面
├── popup.js                   # 设置页面逻辑
├── icons/                     # 插件图标 (需自添加)
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
├── _locales/
│   └── zh_CN/
│       └── messages.json      # 本地化配置
└── README.md                  # 说明文档
```

## 安装方法

### 1. 添加图标文件

由于图标文件需要图像资源，请在 `icons/` 目录下添加以下三个文件：
- `icon16.png` - 16x16 像素图标
- `icon48.png` - 48x48 像素图标
- `icon128.png` - 128x128 像素图标

您可以使用任何图像编辑工具创建这些图标，或使用在线图标生成器。

### 2. 加载到Chrome

1. 打开 Chrome 浏览器
2. 在地址栏输入：`chrome://extensions/`
3. 打开右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择 `nimi` 文件夹
6. 插件安装完成！

### 3. 首次配置

1. 点击浏览器工具栏中的插件图标
2. 在弹出的设置页面中：
   - **模型接口地址**：填入你的本地模型地址（如：`http://localhost:11434/v1/chat/completions`）
   - **API Key**：如果需要的话填入密钥
   - **显示模式**：选择浮窗模式或侧边栏模式
   - **用户指令模板**：可自定义常用指令模板
3. 点击"保存设置"

## 使用说明

### 全文摘要
1. 打开任意网页
2. 点击右下角的 ✨ 按钮
3. 选择"生成全文摘要"
4. 等待 3 秒左右获得结果

### 划词点问
1. 选中网页上的文本（3-800字符）
2. 会出现"💡 点我问"按钮
3. 点击按钮获得解释/翻译/计算结果
4. 结果以 tooltip 形式显示

### 快捷键操作
- `Alt+K` (Mac: `Command+K`)：打开/关闭浮窗
- 右键网页 → "✨ 用nimi生成摘要"：快速生成摘要
- 选中文本右键 → "✨ 用nimi解释选中文本"：解释选中文本

### 右键菜单
插件会在右键菜单中添加以下选项：
- "✨ 用nimi生成摘要"（页面级）
- "✨ 用nimi解释选中文本"（选中时显示）
- "✨ 打开/关闭nimi"（页面级）

## 开发说明

### 技术栈
- **Manifest V3**：Chrome插件最新版本
- **Vanilla JavaScript**：无第三方依赖
- **CSS3**：现代样式

### 核心实现

#### 1. 全文摘要
```javascript
// 在 content-script.js 中
extractPageText() {
  // 克隆body避免修改原页面
  // 移除脚本、导航、广告等干扰元素
  // 提取纯文本并限制4k token
}
```

#### 2. 划词点问
```javascript
// 监听 mouseup/touchend 事件
handleSelection(e) {
  // 获取 window.getSelection()
  // 验证长度 (3-800字符)
  // 注入"点我问"按钮
}
```

#### 3. 浮窗/侧边栏
```javascript
// 使用 CSS position: fixed/absolute
// 支持拖拽 (监听 mousemove)
// 状态持久化到 chrome.storage.sync
```

### 扩展功能

如需添加更多功能，可以在以下文件中修改：

1. **content-script.js**：添加新的UI组件和交互逻辑
2. **background.js**：添加新的快捷键和右键菜单
3. **popup.html/js**：添加新的设置选项

## 注意事项

1. **模型兼容性**：默认兼容 OpenAI API 格式，可接入任何支持该格式的本地或内网模型
2. **Token限制**：全文摘要限制在 4k token（约 16,000 字符）以内
3. **跨域请求**：如需调用非本地 API，需在 `manifest.json` 的 `host_permissions` 中添加对应域名
4. **权限说明**：
   - `activeTab`：读取当前标签页内容
   - `storage`：保存设置和状态
   - `scripting`：注入脚本到网页

## 常见问题

### Q: 模型调用失败？
A: 检查以下项目：
1. 模型服务是否正常运行
2. API地址是否正确
3. API Key是否有效（如果需要）
4. 网络是否连通

### Q: 浮窗无法拖拽？
A: 刷新页面后会恢复正常，拖拽位置不会持久化存储

### Q: 侧边栏遮挡内容？
A: 插件会自动给网页添加 `margin-right: 340px`，如需调整可在 `content-script.js` 中修改

### Q: 如何修改默认快捷键？
A: 在 `manifest.json` 的 `commands` 部分修改 `"suggested_key"`

## 版本历史

- **v1.0.0**：初始版本
  - 实现全文摘要
  - 实现划词点问
  - 实现浮窗/侧边栏双模式
  - 实现快捷键和右键菜单

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request！

---

**注意**：本插件仅用于学习和研究目的，请遵守相关网站的使用条款。
